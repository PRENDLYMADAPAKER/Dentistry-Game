<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Dental Game</title>

<!-- keep your original CSS / fonts here -->
<link rel="stylesheet" href="style.css" />
<style>
/* keep existing glass, gradient, button, animation styles exactly as in your file */
/* (no UI changes) */
</style>
</head>
<body>
<div id="app">
  <!-- ===== HOME SCREEN ===== -->
  <section id="homeScreen" class="screen active">
    <h1>Dental Game</h1>
    <button id="btnWordscapes" class="main-btn">Wordscapes</button>
    <button id="btnQuiz" class="main-btn">Quiz</button>
    <button id="btnCases" class="main-btn">Cases</button>
  </section>

  <!-- ===== GAME SCREEN ===== -->
  <section id="gameScreen" class="screen hidden">
    <div class="top-bar">
      <button id="btnBackHome" class="home-btn">Home</button>
      <h2 id="modeTitle"></h2>
      <span id="timerDisplay"></span>
    </div>

    <div id="contentArea" class="content"></div>

    <div class="nav-bar">
      <button id="prevBtn" class="nav-btn">⬅ Previous</button>
      <span id="doneIndicator" class="indicator"></span>
    </div>
  </section>
</div>

<!-- === AUDIO ELEMENTS === -->
<audio id="bgAudio" loop src="https://actions.google.com/sounds/v1/ambiences/office_ambience.ogg"></audio>
<audio id="clickAudio" src="https://upload.wikimedia.org/wikipedia/commons/1/12/Clickick_switch.ogg"></audio>
<audio id="correctAudio" src="https://upload.wikimedia.org/wikipedia/commons/4/4c/En-us-successes.ogg"></audio>
<audio id="wrongAudio" src="https://orangefreesounds.com/wp-content/uploads/2017/05/Wrong-answer-sound-effect.mp3"></audio>
<audio id="timeoutAudio" src="https://actions.google.com/sounds/v1/alarms/digital_watch_alarm_long.ogg"></audio>

<script>
/* ==============================
   GLOBAL CONFIG + UTILITIES
   ============================== */
const DATA_ROOT = './';
const FILE_WORDS = DATA_ROOT + 'dental_words.json';
const FILE_QUIZ  = DATA_ROOT + 'dental_quiz.json';
const FILE_CASES = DATA_ROOT + 'dental_cases.json';

const KEY_WORD = 'word_progress_v1';
const KEY_QUIZ = 'quiz_progress_v1';
const KEY_CASE = 'case_progress_v1';

const $ = s => document.querySelector(s);
const wait = ms => new Promise(r=>setTimeout(r,ms));
const shuffle = arr => arr.slice().sort(()=>Math.random()-0.5);

/* ==============================
   AUDIO HANDLER
   ============================== */
const sounds = {
  bg: $('#bgAudio'),
  click: $('#clickAudio'),
  correct: $('#correctAudio'),
  wrong: $('#wrongAudio'),
  timeout: $('#timeoutAudio')
};
let muted = false;
function playSFX(name){
  if(muted) return;
  const a = sounds[name];
  if(a){ a.currentTime=0; a.play().catch(()=>{}); }
}
function toggleMute(){ muted=!muted; if(muted) Object.values(sounds).forEach(a=>a.pause()); else sounds.bg.play().catch(()=>{}); }

/* resume bg after tab switch */
document.addEventListener('visibilitychange',()=>{
  if(!document.hidden && !muted) sounds.bg.play().catch(()=>{});
});

/* start background audio after user gesture */
window.addEventListener('click',()=>{ sounds.bg.play().catch(()=>{}); },{once:true});

/* ==============================
   LOAD JSON HELPER
   ============================== */
async function loadJSON(url){
  try{
    const r=await fetch(url);
    if(!r.ok) throw 0;
    return await r.json();
  }catch(e){ console.warn('load fail',url); return []; }
}

/* ==============================
   STATE HOLDERS
   ============================== */
let mode=null;
let words=[], quizData=[], caseData=[];
let wordIndex=0, quizIndex=0, caseIndex=0;
let quizAnswered=new Set(), caseAnswered=new Set();
let timer=null; let timeLeft=0;

function stopTimer(){ if(timer){ clearInterval(timer); timer=null; } }

function countdown(sec,done){
  stopTimer(); timeLeft=sec; $('#timerDisplay').textContent=timeLeft;
  timer=setInterval(()=>{
    timeLeft--; $('#timerDisplay').textContent=timeLeft;
    if(timeLeft<=0){ stopTimer(); done(); }
  },1000);
}

/* ==============================
   LOAD SAVED PROGRESS
   ============================== */
function loadProgress(){
  try{
    const w=JSON.parse(localStorage.getItem(KEY_WORD)||'{}'); if(w.i) wordIndex=w.i;
    const q=JSON.parse(localStorage.getItem(KEY_QUIZ)||'{}');
    if(q.i){ quizIndex=q.i; quizAnswered=new Set(q.ans||[]); }
    const c=JSON.parse(localStorage.getItem(KEY_CASE)||'{}');
    if(c.i){ caseIndex=c.i; caseAnswered=new Set(c.ans||[]); }
  }catch(e){}
}
function saveProgress(){
  localStorage.setItem(KEY_WORD,JSON.stringify({i:wordIndex}));
  localStorage.setItem(KEY_QUIZ,JSON.stringify({i:quizIndex,ans:[...quizAnswered]}));
  localStorage.setItem(KEY_CASE,JSON.stringify({i:caseIndex,ans:[...caseAnswered]}));
}

/* ==============================
   INITIAL LOAD
   ============================== */
window.addEventListener('load',async()=>{
  [words,quizData,caseData]=await Promise.all([
    loadJSON(FILE_WORDS),
    loadJSON(FILE_QUIZ),
    loadJSON(FILE_CASES)
  ]);
  loadProgress();
});

  /* ==============================
   NAVIGATION HANDLERS
   ============================== */
$('#btnWordscapes').onclick = ()=>startMode('word');
$('#btnQuiz').onclick       = ()=>startMode('quiz');
$('#btnCases').onclick      = ()=>startMode('case');
$('#btnBackHome').onclick   = ()=>{ stopTimer(); saveProgress(); showHome(); playSFX('click'); };
$('#prevBtn').onclick       = ()=>goPrevious();

/* show home */
function showHome(){
  mode=null;
  $('#homeScreen').classList.add('active');
  $('#homeScreen').classList.remove('hidden');
  $('#gameScreen').classList.add('hidden');
}

/* start mode */
function startMode(m){
  mode=m;
  $('#homeScreen').classList.remove('active');
  $('#homeScreen').classList.add('hidden');
  $('#gameScreen').classList.remove('hidden');
  $('#modeTitle').textContent =
    m==='word' ? 'Wordscapes' :
    m==='quiz' ? 'Dental Quiz' :
    'Case Scenarios';
  playSFX('click');
  if(m==='word') renderWord();
  if(m==='quiz') renderQuiz();
  if(m==='case') renderCase();
}

/* ==============================
   PREVIOUS HANDLER
   ============================== */
function goPrevious(){
  playSFX('click');
  if(mode==='word' && wordIndex>0){ wordIndex--; renderWord(); }
  if(mode==='quiz' && quizIndex>0){ quizIndex--; renderQuiz(); }
  if(mode==='case' && caseIndex>0){ caseIndex--; renderCase(); }
}

/* ==============================
   WORDSCAPES MODE
   ============================== */
function renderWord(){
  stopTimer();
  if(words.length===0){ $('#contentArea').innerHTML='<p>No words loaded</p>'; return; }

  if(wordIndex>=words.length) wordIndex=0;
  const w=words[wordIndex];
  const done=wordIndex<wordIndex; // placeholder for custom solved logic
  $('#doneIndicator').textContent = '✅ Viewed '+(wordIndex+1)+'/'+words.length;

  $('#contentArea').innerHTML=`
    <div class="word-area">
      <h3>Word ${wordIndex+1}/${words.length}</h3>
      <div class="big-word">${w.word || w}</div>
      <div class="buttons">
        <button id="nextWord">Next</button>
      </div>
    </div>`;
  $('#nextWord').onclick=()=>{ playSFX('click'); wordIndex++; saveProgress(); renderWord(); };
  saveProgress();
}

/* ==============================
   QUIZ MODE
   ============================== */
function renderQuiz(){
  stopTimer();
  if(quizData.length===0){ $('#contentArea').innerHTML='<p>No quiz data</p>'; return; }
  if(quizIndex>=quizData.length) quizIndex=0;
  const q=quizData[quizIndex];
  $('#doneIndicator').textContent =
    quizAnswered.has(quizIndex)?'✅ Answered':'❌ Not answered';

  const opts=shuffle(q.options||[]);
  let html=`<h3>Q${quizIndex+1}/${quizData.length}</h3>
            <div class="question">${q.question}</div>
            <div class="options">`;
  opts.forEach(o=>{
    html+=`<button class="opt">${o}</button>`;
  });
  html+='</div>';
  $('#contentArea').innerHTML=html;

  $$('#contentArea .opt').forEach(b=>{
    b.onclick=async()=>{
      $$('#contentArea .opt').forEach(x=>x.disabled=true);
      stopTimer();
      quizAnswered.add(quizIndex);
      if(b.textContent.trim().toLowerCase()===q.answer.trim().toLowerCase()){
        playSFX('correct');
      }else playSFX('wrong');
      saveProgress();
      await wait(700);
      quizIndex++;
      saveProgress();
      renderQuiz();
    };
  });

  countdown(20,()=>{
    playSFX('timeout');
    quizIndex++;
    saveProgress();
    renderQuiz();
  });
}

/* ==============================
   CASE SCENARIOS MODE
   ============================== */
function renderCase(){
  stopTimer();
  if(caseData.length===0){ $('#contentArea').innerHTML='<p>No case data</p>'; return; }
  if(caseIndex>=caseData.length) caseIndex=0;
  const c=caseData[caseIndex];
  $('#doneIndicator').textContent =
    caseAnswered.has(caseIndex)?'✅ Answered':'❌ Not answered';

  const opts=shuffle(c.options||[]);
  let html=`<h3>Case ${caseIndex+1}/${caseData.length}</h3>
            <div class="case-text">${c.case}</div>
            <div class="options">`;
  opts.forEach(o=>{
    html+=`<button class="opt">${o}</button>`;
  });
  html+='</div>';
  $('#contentArea').innerHTML=html;

  $$('#contentArea .opt').forEach(b=>{
    b.onclick=async()=>{
      $$('#contentArea .opt').forEach(x=>x.disabled=true);
      stopTimer();
      caseAnswered.add(caseIndex);
      if(b.textContent.trim().toLowerCase()===c.answer.trim().toLowerCase()){
        playSFX('correct');
      }else playSFX('wrong');
      saveProgress();
      await wait(700);
      caseIndex++;
      saveProgress();
      renderCase();
    };
  });

  countdown(30,()=>{
    playSFX('timeout');
    caseIndex++;
    saveProgress();
    renderCase();
  });
 }

  /* ==============================
   END OF SCRIPT
   ============================== */
</script>

<!-- optional footer or credits -->
<footer style="text-align:center;margin-top:20px;font-size:12px;color:#888;">
  <p>Dental Game © 2025 — Enhanced version with save/resume, sounds, and answered tracking.</p>
</footer>

</body>
</html>
