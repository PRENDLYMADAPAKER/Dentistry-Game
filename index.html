<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dental Hub Games</title>
<style>
  :root{
    --accent:#00eaff; --accent2:#00ffb7; --glass-bg: rgba(0,40,80,0.36);
    --muted:#b6eaff; --white: #ffffff;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background: radial-gradient(circle at top left, #001427 0%, #00111f 35%, #000814 100%);
    color:var(--white); min-height:100vh; overflow-x:hidden;
  }

  /* Floating bubbles container */
  .bubbles { position:fixed; inset:0; z-index:0; pointer-events:none; overflow:hidden; }
  .bubble {
    position:absolute; bottom:-120px; border-radius:50%;
    background: rgba(255,255,255,0.12);
    filter: blur(0.6px);
    animation: rise linear infinite;
    box-shadow: 0 6px 18px rgba(0,200,255,0.035);
  }
  @keyframes rise {
    0% { transform: translateY(0) scale(1); opacity:0.9; }
    100% { transform: translateY(-140vh) scale(1.6); opacity:0; }
  }

  header{ text-align:center; padding-top:30px; z-index:2; position:relative; }
  header h1{
    margin:0; font-size:28px; letter-spacing:1px;
    background: linear-gradient(90deg,var(--accent),var(--accent2));
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  }
  header p{ margin:6px 0 0; font-style:italic; color:var(--muted); }

  main{ z-index:2; position:relative; padding:28px 18px 60px; display:flex; flex-direction:column; align-items:center; gap:20px; }

  /* home tiles */
  .home { display:flex; flex-direction:column; gap:16px; width:100%; max-width:920px; align-items:center; }
  .tile {
    width:92%; max-width:720px; background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:20px; padding:18px; text-align:left;
    display:flex; align-items:center; justify-content:space-between; gap:12px;
    border:1px solid rgba(255,255,255,0.04); cursor:pointer; transition: transform .22s, box-shadow .22s;
    backdrop-filter: blur(10px);
  }
  .tile:hover{ transform: translateY(-6px); box-shadow:0 30px 60px rgba(0,0,0,0.35); }
  .tile .left{ display:flex; align-items:center; gap:14px; }
  .tile .icon{ width:56px;height:56px;border-radius:12px; display:grid; place-items:center; font-weight:800;
    background: linear-gradient(135deg,var(--accent),var(--accent2)); color:#002; box-shadow:0 8px 30px rgba(0,224,255,0.08); }
  .tile h3{ margin:0; font-size:18px; }
  .tile p{ margin:4px 0 0; color:var(--muted); font-size:13px; }

  /* game-area (glass panel) */
  .game-area { display:none; width:100%; max-width:920px; justify-content:center; padding:24px; }
  .game-panel{
    width:92%; max-width:640px; margin:0 auto; background:var(--glass-bg);
    border-radius:20px; padding:20px; color:var(--white);
    backdrop-filter: blur(14px) saturate(150%); -webkit-backdrop-filter: blur(14px) saturate(150%);
    border:1px solid rgba(255,255,255,0.08); box-shadow:0 30px 80px rgba(0,0,0,0.45);
    transform-origin:center; opacity:0; transform:scale(.98) translateY(10px);
    transition: transform .36s cubic-bezier(.2,.9,.3,1), opacity .28s;
  }
  .game-panel.show{ opacity:1; transform:scale(1) translateY(0); }

  .game-header{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px; }
  .home-btn{ background:rgba(255,255,255,0.06); border:1px solid rgba(255,255,255,0.06); color:var(--white); padding:8px 12px; border-radius:12px; cursor:pointer; }
  .home-btn:hover{ background:rgba(255,255,255,0.09); transform:translateY(-2px); }

  .game-stats { display:flex; align-items:center; gap:12px; font-weight:700; color:var(--muted); }
  .game-stats span strong{ color:var(--white); margin-left:6px; }

  h2#question{ text-align:center; margin:16px 0 18px; font-size:20px; }

  .options{ display:flex; flex-direction:column; gap:10px; }
  .option-btn{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border:1px solid rgba(255,255,255,0.06);
    padding:12px; border-radius:12px; color:var(--white); font-weight:700; cursor:pointer;
    transition:transform .16s, background .16s;
  }
  .option-btn:hover{ transform:translateY(-4px); background: rgba(255,255,255,0.03); }

  /* wordscape extras */
  .word-row{ display:flex; gap:8px; justify-content:center; flex-wrap:wrap; margin:12px 0; }
  .letter-chip{ background: rgba(255,255,255,0.04); padding:8px 10px; border-radius:8px; font-weight:800; cursor:pointer; }

  /* small controls */
  .controls { position:fixed; right:18px; bottom:18px; z-index:10; display:flex; gap:8px; }
  .circle-btn{ width:46px;height:46px;border-radius:50%; border:none; background:rgba(255,255,255,0.05); color:var(--white); cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.4); }

  /* responsive */
  @media (max-width:700px){
    header h1{ font-size:20px; } .tile{ width:94%; }
    .game-panel{ width:94%; padding:16px; border-radius:16px; }
  }
</style>
</head>
<body>
  <!-- Bubbles (will be dynamically filled) -->
  <div class="bubbles" id="bubbles"></div>

  <header>
    <h1>DENTAL HUB GAMES</h1>
    <p><i>Test your knowledge</i></p>
  </header>

  <main>
    <section class="home" id="home">
      <div class="tile" id="openWordscape">
        <div class="left">
          <div class="icon">üß©</div>
          <div>
            <h3>Dental Wordscape</h3>
            <p>Form dental terms from letters</p>
          </div>
        </div>
        <div class="meta"><strong id="hsWord">0</strong> pts</div>
      </div>

      <div class="tile" id="openQuiz">
        <div class="left">
          <div class="icon">üìò</div>
          <div>
            <h3>Dental Quiz Game</h3>
            <p>Timed multiple-choice (15s)</p>
          </div>
        </div>
        <div class="meta"><strong id="hsQuiz">0</strong> pts</div>
      </div>

      <div class="tile" id="openCase">
        <div class="left">
          <div class="icon">üí¨</div>
          <div>
            <h3>Case Challenge</h3>
            <p>Clinical scenario practice</p>
          </div>
        </div>
        <div class="meta"><strong id="hsCase">0</strong> pts</div>
      </div>
    </section>

    <!-- Game area -->
    <section class="game-area" id="gameArea" aria-hidden="true">
      <div class="game-panel" id="gamePanel">
        <div class="game-header">
          <button class="home-btn" id="btnHome">üè†</button>
          <div class="game-stats">
            <span>Score <strong id="scoreDisplay">0</strong></span>
            <span>‚è± <strong id="timerDisplay">15</strong>s</span>
          </div>
        </div>

        <h2 id="question">Loading...</h2>
        <div id="contentArea">
          <!-- dynamic content (quiz/options/letters) will be injected here -->
        </div>
      </div>
    </section>
  </main>

  <div class="controls">
    <button id="muteBtn" class="circle-btn" title="Mute / Unmute">üîä</button>
    <button id="backspaceBtn" class="circle-btn" title="Undo last (Wordscape)">‚å´</button>
  </div>

  <!-- background music (royalty-free link); autoplay softly -->
  <audio id="bgAudio" loop crossorigin="anonymous">
    <source src="https://cdn.pixabay.com/download/audio/2023/03/08/audio_6e56e3a30a.mp3?filename=relaxing-background-music-141069.mp3" type="audio/mpeg">
  </audio>

  <script>
/* ------------------ Configuration ------------------ */
const wordURL = "https://raw.githubusercontent.com/PRENDLYMADAPAKER/DentalGameData/refs/heads/main/dental_words.json";
const quizURL =  "https://raw.githubusercontent.com/PRENDLYMADAPAKER/DentalGameData/refs/heads/main/dental_quiz.json";
const caseURL =  "https://raw.githubusercontent.com/PRENDLYMADAPAKER/DentalGameData/refs/heads/main/dental_cases.json";

/* ------------------ Elements ------------------ */
const bubblesEl = document.getElementById('bubbles');
const homeEl = document.getElementById('home');
const gameArea = document.getElementById('gameArea');
const gamePanel = document.getElementById('gamePanel');
const contentArea = document.getElementById('contentArea');
const questionEl = document.getElementById('question');
const scoreDisplay = document.getElementById('scoreDisplay');
const timerDisplay = document.getElementById('timerDisplay');
const btnHome = document.getElementById('btnHome');
const muteBtn = document.getElementById('muteBtn');
const backspaceBtn = document.getElementById('backspaceBtn');
const bgAudio = document.getElementById('bgAudio');

/* ------------------ Visual / Interaction Setup ------------------ */
// generate moderate-speed floating bubbles
function makeBubbles(count=18){
  const vw = Math.max(document.documentElement.clientWidth || 0, window.innerWidth || 0);
  for(let i=0;i<count;i++){
    const b = document.createElement('div');
    b.className='bubble';
    const size = 12 + Math.random()*42; // px
    b.style.width = b.style.height = size + 'px';
    b.style.left = (Math.random()*100) + 'vw';
    b.style.animationDuration = (8 + Math.random()*9) + 's'; // moderate speed
    b.style.opacity = (0.5 + Math.random()*0.6).toString();
    bubblesEl.appendChild(b);
  }
}
makeBubbles(22);

/* ------------------ Audio ------------------ */
let muted = false;
bgAudio.volume = 0.16;
bgAudio.play().catch(()=>{ /* autoplay might be blocked; user can press muteBtn to start */ });

muteBtn.addEventListener('click', ()=>{
  muted = !muted;
  bgAudio.muted = muted;
  muteBtn.textContent = muted ? 'üîá' : 'üîä';
});

/* ------------------ Highscore helpers ------------------ */
const KEY_HS_WORD = 'dh_hs_word_v1';
const KEY_HS_QUIZ = 'dh_hs_quiz_v1';
const KEY_HS_CASE = 'dh_hs_case_v1';
function getHS(key){ return Number(localStorage.getItem(key) || 0); }
function setHS(key,val){ localStorage.setItem(key, String(val)); }
function refreshHSUI(){
  document.getElementById('hsWord').textContent = getHS(KEY_HS_WORD);
  document.getElementById('hsQuiz').textContent = getHS(KEY_HS_QUIZ);
  document.getElementById('hsCase').textContent = getHS(KEY_HS_CASE);
}
refreshHSUI();

/* ------------------ Screen helpers ------------------ */
function openGamePanel(){
  homeEl.style.display = 'none';
  gameArea.style.display = 'flex';
  setTimeout(()=> gamePanel.classList.add('show'), 20);
  gameArea.setAttribute('aria-hidden','false');
}
function closeGamePanel(){
  gamePanel.classList.remove('show');
  setTimeout(()=> {
    gameArea.style.display = 'none';
    homeEl.style.display = '';
    contentArea.innerHTML = '';
    questionEl.textContent = 'Loading...';
    stopAllTimers();
    refreshHSUI();
  }, 320);
}

/* Home (tiles) click bindings */
document.getElementById('openWordscape').addEventListener('click', ()=> startWordscape());
document.getElementById('openQuiz').addEventListener('click', ()=> startQuiz());
document.getElementById('openCase').addEventListener('click', ()=> startCase());
btnHome.addEventListener('click', ()=> closeGamePanel());

/* ------------------ Timers ------------------ */
let currentTimer = null;
function stopAllTimers(){
  if(currentTimer){ clearInterval(currentTimer); currentTimer = null; }
}
function startCountdown(seconds, onTick, onExpire){
  stopAllTimers();
  let t = Math.max(0, Math.floor(seconds));
  timerDisplay.textContent = t;
  onTick && onTick(t);
  currentTimer = setInterval(()=>{
    t--;
    timerDisplay.textContent = Math.max(0, t);
    onTick && onTick(t);
    if(t <= 0){
      clearInterval(currentTimer); currentTimer = null;
      onExpire && onExpire();
    }
  }, 1000);
}

/* ------------------ Utility ------------------ */
function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5); }
function playSFX(url){ if(muted) return; const a=new Audio(url); a.volume=0.7; a.play().catch(()=>{}); }

/* ============================
   WORDSCAPE
   - tap letters to add
   - clickable chips to remove (undo)
   - Backspace button also removes last
   - score persisted
   ============================ */
let wordList = [];
let currentWord = '';
let shuffledLetters = [];
let selectedArr = [];
let wsScore = 0;

async function startWordscape(){
  stopAllTimers();
  openGamePanel();
  // load words
  try{
    const r = await fetch(wordURL);
    const d = await r.json();
    if(Array.isArray(d) && d.length) wordList = d.map(s=>String(s).toUpperCase());
    else if(Array.isArray(d.words)) wordList = d.words.map(s=>String(s).toUpperCase());
    else throw new Error('bad format');
  }catch(e){
    console.warn('word fetch failed, using fallback', e);
    wordList = ["ENAMEL","CROWN","MOLAR","PLAQUE","DENTIN","PULP","CARIES","GINGIVA"];
  }
  wsScore = Number(localStorage.getItem('word_score') || 0);
  scoreDisplay.textContent = wsScore;
  prepareNextWord();
  // backspace button only affects wordscape
  backspaceBtn.style.display = 'inline-block';
}

function prepareNextWord(){
  stopAllTimers();
  selectedArr = [];
  currentWord = String(wordList[Math.floor(Math.random()*wordList.length)] || 'ENAMEL').toUpperCase().replace(/[^A-Z]/g,'');
  shuffledLetters = shuffle(currentWord.split(''));
  renderWordscapeUI();
  // start a small per-word "word timer" (optional) - we'll show 15s but not penalize, just auto-next on expiry
  startCountdown(15, null, ()=> { // timeout -> next word
    playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_262f2667c2.mp3?filename=error-126627.mp3'); // soft
    setTimeout(prepareNextWord, 600);
  });
}

function renderWordscapeUI(){
  questionEl.textContent = 'Form the word';
  const html = [];
  // selected chips
  const chips = selectedArr.map((c, idx)=> `<div class="letter-chip" data-idx="${idx}">${c}</div>`).join('');
  const lettersButtons = shuffledLetters.map((ch, i)=> {
    const disabled = ch === '' ? 'disabled' : '';
    return `<button class="option-btn letter-btn" data-i="${i}" ${disabled}>${ch || ''}</button>`;
  }).join('');
  contentArea.innerHTML = `
    <div class="word-row" id="wsChips">${chips}</div>
    <div style="text-align:center; font-weight:700; margin-bottom:8px">(${selectedArr.join('') || Array.from({length:currentWord.length}).map(()=> '‚Ä¢').join(' ')})</div>
    <div class="word-row" id="wsLetters">${lettersButtons}</div>
    <div style="margin-top:12px; text-align:center; color:var(--muted)" id="wsMsg"></div>
  `;
  // wire up letter buttons
  contentArea.querySelectorAll('.letter-btn').forEach(btn=>{
    btn.addEventListener('click', (ev)=>{
      const i = Number(btn.getAttribute('data-i'));
      if(btn.disabled) return;
      playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_0f0f3f2c2a.mp3?filename=soft-click-6002.mp3');
      selectedArr.push(shuffledLetters[i]);
      shuffledLetters[i] = '';
      renderWordscapeUI();
      // check completion
      if(selectedArr.length === currentWord.length){
        const formed = selectedArr.join('');
        if(formed === currentWord){
          playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_7e7c1e3b36.mp3?filename=correct-2-46134.mp3');
          wsScore += 10;
          localStorage.setItem('word_score', wsScore);
          scoreDisplay.textContent = wsScore;
          document.getElementById('wsMsg').textContent = 'Correct ‚Äî ' + formed;
          setTimeout(prepareNextWord, 700);
        } else {
          playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_262f2667c2.mp3?filename=error-126627.mp3');
          document.getElementById('wsMsg').textContent = 'Incorrect ‚Äî try again';
          setTimeout(prepareNextWord, 900);
        }
      }
    });
  });

  // chips click to remove that selected letter and restore to first empty slot
  contentArea.querySelectorAll('.letter-chip').forEach(chip=>{
    chip.addEventListener('click', ()=>{
      const idx = Number(chip.getAttribute('data-idx'));
      const removed = selectedArr.splice(idx,1)[0];
      // restore into first empty slot
      const emptyIndex = shuffledLetters.indexOf('');
      if(emptyIndex !== -1) shuffledLetters[emptyIndex] = removed;
      else shuffledLetters.push(removed);
      renderWordscapeUI();
      playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_0f0f3f2c2a.mp3?filename=soft-click-6002.mp3');
    });
  });

  // backspace control (button)
  backspaceBtn.onclick = ()=> {
    if(selectedArr.length === 0) return;
    const removed = selectedArr.pop();
    const emptyIdx = shuffledLetters.indexOf('');
    if(emptyIdx !== -1) shuffledLetters[emptyIdx] = removed;
    else shuffledLetters.push(removed);
    renderWordscapeUI();
    playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_0f0f3f2c2a.mp3?filename=soft-click-6002.mp3');
  };
}

/* ---------------------------
   QUIZ
   - tolerant parsing: options|choices|answers
   - 15s timer reset on each question
   --------------------------- */
let quizData = [], quizIndex=0, quizScore=0;
async function startQuiz(){
  stopAllTimers();
  openGamePanel();
  backspaceBtn.style.display = 'none';
  // fetch quiz
  try{
    const res = await fetch(quizURL);
    const d = await res.json();
    if(Array.isArray(d) && d.length) quizData = d;
    else if(Array.isArray(d.questions)) quizData = d.questions;
    else {
      quizData = [
        { question:"Which tissue covers the crown of a tooth?", options:["Cementum","Dentin","Enamel","Pulp"], answer:"Enamel" }
      ];
    }
  }catch(e){
    console.warn('quiz fetch error', e);
    quizData = [
      { question:"Which tissue covers the crown of a tooth?", options:["Cementum","Dentin","Enamel","Pulp"], answer:"Enamel" }
    ];
  }
  quizScore = Number(localStorage.getItem('quiz_score') || 0);
  scoreDisplay.textContent = quizScore;
  quizIndex = 0;
  renderQuizQuestion();
}

function renderQuizQuestion(){
  stopAllTimers();
  const q = quizData[quizIndex];
  if(!q){ questionEl.textContent = 'No questions'; contentArea.innerHTML = ''; return; }
  const qText = q.question || q.stem || q.title || 'Untitled question';
  const choices = q.options || q.choices || q.answers || [];
  const correct = q.answer || q.correct || q.solution || null;
  questionEl.textContent = qText;

  if(!Array.isArray(choices) || choices.length === 0){
    contentArea.innerHTML = `<div style="text-align:center; color:var(--muted)">No choices. Auto-next in 5s.</div>`;
    startCountdown(5, null, ()=> { quizIndex = (quizIndex+1) % quizData.length; renderQuizQuestion(); } );
    return;
  }

  // build choice buttons
  contentArea.innerHTML = `<div class="options" id="quizOptions"></div>`;
  const optWrap = document.getElementById('quizOptions');
  const shuffled = shuffle(choices);
  shuffled.forEach(choice=>{
    const b = document.createElement('button');
    b.className = 'option-btn';
    b.textContent = choice;
    b.addEventListener('click', ()=>{
      // disable further clicks
      optWrap.querySelectorAll('button').forEach(x=> x.disabled = true);
      stopAllTimers();
      // tolerant compare
      if(correct !== null && String(choice).trim().toLowerCase() === String(correct).trim().toLowerCase()){
        playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_7e7c1e3b36.mp3?filename=correct-2-46134.mp3');
        quizScore += 10;
        localStorage.setItem('quiz_score', quizScore);
        scoreDisplay.textContent = quizScore;
      } else {
        playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_262f2667c2.mp3?filename=error-126627.mp3');
      }
      setTimeout(()=> {
        quizIndex = (quizIndex+1) % quizData.length;
        renderQuizQuestion();
      }, 800);
    });
    optWrap.appendChild(b);
  });

  // start 15s timer for this question
  startCountdown(15, null, ()=> {
    // time's up -> auto next
    playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_262f2667c2.mp3?filename=error-126627.mp3');
    quizIndex = (quizIndex+1) % quizData.length;
    renderQuizQuestion();
  });
}

/* ---------------------------
   CASE CHALLENGE
   - tolerant parsing: options|choices
   --------------------------- */
let caseData = [], caseIndex=0, caseScore=0;
async function startCase(){
  stopAllTimers();
  openGamePanel();
  backspaceBtn.style.display = 'none';
  try{
    const r = await fetch(caseURL);
    const d = await r.json();
    if(Array.isArray(d) && d.length) caseData = d;
    else if(Array.isArray(d.cases)) caseData = d.cases;
    else {
      caseData = [
        { case: "25-year-old with sharp pain on biting in a lower molar with deep caries. Most likely?", options:["Gingivitis","Pulpitis","Periodontitis","Pericoronitis"], answer:"Pulpitis" }
      ];
    }
  }catch(e){
    console.warn('case fetch fail', e);
    caseData = [
      { case: "25-year-old with sharp pain on biting in a lower molar with deep caries. Most likely?", options:["Gingivitis","Pulpitis","Periodontitis","Pericoronitis"], answer:"Pulpitis" }
    ];
  }
  caseScore = Number(localStorage.getItem('case_score') || 0);
  scoreDisplay.textContent = caseScore;
  caseIndex = 0;
  renderCaseQuestion();
}

function renderCaseQuestion(){
  stopAllTimers();
  const c = caseData[caseIndex];
  if(!c){ questionEl.textContent = 'No cases'; contentArea.innerHTML=''; return; }
  const stem = c.case || c.stem || c.title || 'Case';
  const choices = c.options || c.choices || [];
  const correct = c.answer || c.correct || null;
  questionEl.textContent = stem;

  if(!Array.isArray(choices) || choices.length === 0){
    contentArea.innerHTML = `<div style="text-align:center;color:var(--muted)">No options ‚Äî auto-next in 5s.</div>`;
    startCountdown(5, null, ()=> { caseIndex = (caseIndex+1) % caseData.length; renderCaseQuestion(); } );
    return;
  }

  contentArea.innerHTML = `<div class="options" id="caseOptions"></div>`;
  const w = document.getElementById('caseOptions');
  shuffle(choices).forEach(opt=>{
    const b = document.createElement('button');
    b.className = 'option-btn';
    b.textContent = opt;
    b.addEventListener('click', ()=>{
      w.querySelectorAll('button').forEach(x=> x.disabled = true);
      stopAllTimers();
      if(correct !== null && String(opt).trim().toLowerCase() === String(correct).trim().toLowerCase()){
        playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_7e7c1e3b36.mp3?filename=correct-2-46134.mp3');
        caseScore += 10;
        localStorage.setItem('case_score', caseScore);
        scoreDisplay.textContent = caseScore;
      } else {
        playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_262f2667c2.mp3?filename=error-126627.mp3');
      }
      setTimeout(()=> { caseIndex = (caseIndex+1) % caseData.length; renderCaseQuestion(); }, 800);
    });
    w.appendChild(b);
  });

  startCountdown(15, null, ()=> {
    playSFX('https://cdn.pixabay.com/download/audio/2022/03/15/audio_262f2667c2.mp3?filename=error-126627.mp3');
    caseIndex = (caseIndex+1) % caseData.length; renderCaseQuestion();
  });
}

/* ---------------------------
   Keyboard: Backspace for Wordscape
   --------------------------- */
window.addEventListener('keydown', (e)=>{
  if(e.key === 'Backspace'){
    if(gameArea.style.display !== 'none'){
      // If in wordscape (we detect via current question text or selectedArr)
      // We'll attempt to remove last selected letter if the UI contains wsChips
      const chips = document.querySelectorAll('#wsChips .letter-chip');
      if(chips && chips.length > 0){
        chips[chips.length-1].click(); // triggers chip removal logic
      }
    }
  }
});

/* ---------------------------
   Init / housekeeping
   --------------------------- */
refreshHSUI();
gameArea.style.display = 'none';
backspaceBtn.style.display = 'none';

// ensure audio resumes on first user gesture if autoplay blocked
window.addEventListener('pointerdown', function resumeAudio(){ 
  if(bgAudio.paused && !muted){ bgAudio.play().catch(()=>{}); }
  window.removeEventListener('pointerdown', resumeAudio);
}, { once:true });
</script>
</body>
</html>
