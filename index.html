<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dental Hub Games</title>

<style>
:root{
 --accent:#00eaff;--accent2:#00ffb7;
 --glass-bg:rgba(255,255,255,0.08);
 --panel-bg:rgba(255,255,255,0.06);
 --frost-bg:rgba(255,255,255,0.22);
 --frost-blur:blur(16px) saturate(180%);
 --muted:#b6eaff;--white:#fff;
}
*{box-sizing:border-box}
body{
 margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial;
 background:radial-gradient(circle at top left,#001427 0%,#00111f 35%,#000814 100%);
 color:var(--white);min-height:100vh;overflow-x:hidden;
}
.bubbles{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden;}
.bubble{position:absolute;bottom:-120px;border-radius:50%;background:rgba(255,255,255,0.1);
 filter:blur(.6px);animation:rise linear infinite;}
@keyframes rise{0%{transform:translateY(0) scale(1);opacity:.9;}
100%{transform:translateY(-140vh) scale(1.6);opacity:0;}}
header{text-align:center;padding-top:30px;z-index:2;position:relative;}
header h1{margin:0;font-size:28px;letter-spacing:1px;
background:linear-gradient(90deg,var(--accent),var(--accent2));
-webkit-background-clip:text;-webkit-text-fill-color:transparent;}
header p{margin:6px 0 0;font-style:italic;color:var(--muted);}
main{z-index:2;position:relative;padding:28px 18px 60px;
display:flex;flex-direction:column;align-items:center;gap:20px;}
.home{display:flex;flex-direction:column;gap:16px;width:100%;max-width:920px;align-items:center;}
.tile{width:92%;max-width:720px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
border-radius:20px;padding:18px;display:flex;align-items:center;justify-content:space-between;gap:12px;
border:1px solid rgba(255,255,255,0.04);cursor:pointer;transition:.22s;backdrop-filter:blur(10px);}
.tile:hover{transform:translateY(-6px);box-shadow:0 30px 60px rgba(0,0,0,0.35);}
.tile .left{display:flex;align-items:center;gap:14px;}
.icon{width:56px;height:56px;border-radius:12px;display:grid;place-items:center;font-weight:800;
background:linear-gradient(135deg,var(--accent),var(--accent2));color:#002;
box-shadow:0 8px 30px rgba(0,224,255,0.08);}
.tile h3{margin:0;font-size:18px;}
.tile p{margin:4px 0 0;color:var(--muted);font-size:13px;}
.game-area{display:none;width:100%;max-width:920px;justify-content:center;padding:24px;}
.game-panel{width:92%;max-width:640px;margin:0 auto;background:var(--glass-bg);
border-radius:20px;padding:20px;color:var(--white);backdrop-filter:blur(14px) saturate(150%);
border:1px solid rgba(255,255,255,0.08);box-shadow:0 30px 80px rgba(0,0,0,0.45);
opacity:0;transform:scale(.98) translateY(10px);
transition:.36s cubic-bezier(.2,.9,.3,1);}
.game-panel.show{opacity:1;transform:scale(1) translateY(0);}
.game-header{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-bottom:12px;}
.home-btn{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.06);
color:var(--white);padding:8px 12px;border-radius:12px;cursor:pointer;}
.home-btn:hover{background:rgba(255,255,255,0.09);transform:translateY(-2px);}
.game-stats{display:flex;align-items:center;gap:12px;font-weight:700;color:var(--muted);}
.game-stats span strong{color:var(--white);margin-left:6px;}
h2#question{text-align:center;margin:16px 0 18px;font-size:20px;}
.options{display:flex;flex-direction:column;gap:10px;}
.option-btn{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
border:1px solid rgba(255,255,255,0.06);padding:12px;border-radius:12px;color:var(--white);
font-weight:700;cursor:pointer;transition:.16s;}
.option-btn:hover{transform:translateY(-4px);background:rgba(255,255,255,0.03);}
.word-row{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:12px 0;}
.letter-chip{background:rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;font-weight:800;cursor:pointer;transition:.15s;}
.letter-chip.pop{transform:scale(1.3);background:rgba(0,255,200,0.2);}
.controls{position:fixed;right:18px;bottom:18px;z-index:10;display:flex;gap:8px;}
.circle-btn{width:46px;height:46px;border-radius:50%;border:none;
background:rgba(255,255,255,0.05);color:var(--white);cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,0.4);}
.toast{position:fixed;bottom:40px;left:50%;transform:translateX(-50%);
background:rgba(0,0,0,0.75);color:#fff;padding:10px 18px;border-radius:10px;
font-weight:700;opacity:0;transition:opacity .4s,transform .4s;z-index:9999;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(-10px);}
.option-btn.correct{background:rgba(0,255,120,0.25);border-color:rgba(0,255,120,0.6);}
.option-btn.wrong{background:rgba(255,60,60,0.25);border-color:rgba(255,60,60,0.6);}

/* Frosted popup modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.55);
display:none;align-items:center;justify-content:center;z-index:999;}
.modal{background:var(--frost-bg);backdrop-filter:var(--frost-blur);
border:1px solid rgba(255,255,255,0.4);border-radius:18px;padding:24px 28px;max-width:340px;
text-align:center;color:#003;box-shadow:0 8px 30px rgba(0,0,0,0.5);}
.modal h3{margin-top:0;margin-bottom:12px;font-size:20px;color:#002;}
.modal button{margin:6px;padding:10px 18px;border:none;border-radius:10px;cursor:pointer;
background:linear-gradient(135deg,#b8e9ff,#dffff3);color:#003;font-weight:700;transition:.2s;}
.modal button:hover{transform:translateY(-2px);}

/* Progress bar (for Wordscape levels) */
.progress-bar{width:100%;height:10px;background:rgba(255,255,255,0.1);border-radius:10px;overflow:hidden;margin-top:6px;}
.progress-fill{height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .4s ease;}

/* Stats Dashboard Cards */
.stats{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-top:10px;}
.stat-card{flex:1 1 150px;min-width:140px;background:rgba(255,255,255,0.04);
padding:12px;border-radius:14px;text-align:center;font-size:14px;border:1px solid rgba(255,255,255,0.08);}
.stat-card strong{display:block;font-size:18px;color:var(--accent2);}

/* Dark/light toggle */
.theme-toggle{position:fixed;left:18px;bottom:18px;width:46px;height:46px;border-radius:50%;border:none;
background:rgba(255,255,255,0.05);color:var(--white);cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,0.4);}

/* Responsive */
@media(max-width:700px){
 header h1{font-size:22px;}
 .tile{width:94%;}
 .game-panel{width:94%;padding:16px;border-radius:16px;}
}
</style>
</head>

<body>
<div class="bubbles" id="bubbles"></div>

<header>
 <h1>DENTAL HUB GAMES</h1>
 <p><i>Test your knowledge and skill</i></p>
</header>

<main>
 <section class="home" id="home">
  <div class="tile" id="openWordscape"><div class="left">
   <div class="icon">üß©</div><div><h3>Dental Wordscape</h3><p>Form dental terms from letters</p></div></div>
   <div class="meta"><strong id="hsWord">0</strong> pts</div></div>

  <div class="tile" id="openQuiz"><div class="left">
   <div class="icon">üìò</div><div><h3>Dental Quiz Game</h3><p>Timed multiple choice</p></div></div>
   <div class="meta"><strong id="hsQuiz">0</strong> pts</div></div>

  <div class="tile" id="openCase"><div class="left">
   <div class="icon">üí¨</div><div><h3>Case Challenge</h3><p>Clinical scenario practice</p></div></div>
   <div class="meta"><strong id="hsCase">0</strong> pts</div></div>

  <div class="tile" id="openRetry"><div class="left">
   <div class="icon">üîÅ</div><div><h3>Retry Missed</h3><p>Review your previous mistakes</p></div></div>
  </div>

  <div class="stats" id="dashboardStats"></div>
 </section>

 <section class="game-area" id="gameArea" aria-hidden="true">
  <div class="game-panel" id="gamePanel">
   <div class="game-header">
    <button class="home-btn" id="btnHome">üè†</button>
    <div class="game-stats">
     <span>Score <strong id="scoreDisplay">0</strong></span>
     <span>‚è± <strong id="timerDisplay">15</strong>s</span>
    </div>
   </div>
   <h2 id="question">Loading...</h2>
   <div id="contentArea"></div>
  </div>
 </section>
</main>

<div class="controls">
 <button id="muteBtn" class="circle-btn" title="Mute/Unmute">üîä</button>
 <button id="backspaceBtn" class="circle-btn" title="Undo last (Wordscape)">‚å´</button>
 <button id="resetBtn" class="circle-btn" title="Reset Progress">‚ôªÔ∏è</button>
 <button id="themeBtn" class="theme-toggle" title="Toggle Theme">üåó</button>
</div>

<!-- Difficulty Popup -->
<div class="modal-overlay" id="difficultyModal">
 <div class="modal">
  <h3>Select Difficulty</h3>
  <p>Choose your challenge level:</p>
  <button data-diff="easy">ü©µ Easy (No Timer)</button>
  <button data-diff="normal">üíô Normal (15 s)</button>
  <button data-diff="hard">üíé Hard (10 s)</button>
 </div>
</div>

<audio id="bgAudio" loop crossorigin="anonymous">
 <source src="https://cdn.pixabay.com/download/audio/2023/03/08/audio_6e56e3a30a.mp3?filename=relaxing-background-music-141069.mp3" type="audio/mpeg">
</audio>

<script src="dental_words.js"></script>
<script src="dental_quiz.js"></script>
<script src="dental_cases.js"></script>

  <script>
/* ---------- Utility + Toast ---------- */
function showToast(text){
 let t=document.querySelector(".toast");
 if(!t){t=document.createElement("div");t.className="toast";document.body.appendChild(t);}
 t.textContent=text;t.classList.add("show");
 setTimeout(()=>t.classList.remove("show"),1500);
}
function vibrate(ms=40){if("vibrate"in navigator)navigator.vibrate(ms);}
function animateScore(el,from,to){
 let start=from,range=to-from,steps=20,i=0;
 const step=()=>{i++;el.textContent=Math.round(start+range*(i/steps));
  if(i<steps)requestAnimationFrame(step);};step();
}

/* ---------- Audio ---------- */
const bgAudio=document.getElementById("bgAudio"),
muteBtn=document.getElementById("muteBtn");
let muted=localStorage.getItem("muted")==="true";
const sfx={
 click:new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_0f0f3f2c2a.mp3?filename=soft-click-6002.mp3"),
 correct:new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_7e7c1e3b36.mp3?filename=correct-2-46134.mp3"),
 wrong:new Audio("https://cdn.pixabay.com/download/audio/2022/03/15/audio_262f2667c2.mp3?filename=error-126627.mp3")
};
function playSFX(name){if(!muted){const a=sfx[name];if(a){a.currentTime=0;a.play().catch(()=>{});}}}
bgAudio.volume=.15;bgAudio.loop=true;bgAudio.muted=muted;bgAudio.play().catch(()=>{});
muteBtn.textContent=muted?"üîá":"üîä";
muteBtn.onclick=()=>{muted=!muted;localStorage.setItem("muted",muted);
bgAudio.muted=muted;muteBtn.textContent=muted?"üîá":"üîä";};

/* ---------- Helpers ---------- */
function shuffle(a){return a.slice().sort(()=>Math.random()-.5);}
function saveJSON(k,v){localStorage.setItem(k,JSON.stringify(v));}
function loadJSON(k){try{return JSON.parse(localStorage.getItem(k));}catch{return null;}}
const KEY_HS_WORD="dh_hs_word",KEY_HS_QUIZ="dh_hs_quiz",KEY_HS_CASE="dh_hs_case";
function getHS(k){return Number(localStorage.getItem(k)||0);}
function setHS(k,v){localStorage.setItem(k,String(v));}
function refreshHS(){
 document.getElementById("hsWord").textContent=getHS(KEY_HS_WORD);
 document.getElementById("hsQuiz").textContent=getHS(KEY_HS_QUIZ);
 document.getElementById("hsCase").textContent=getHS(KEY_HS_CASE);
}

/* ---------- Timer & Difficulty ---------- */
let currentTimer=null,difficulty="normal";
const diffModal=document.getElementById("difficultyModal");
function askDifficulty(cb){
 diffModal.style.display="flex";
 diffModal.querySelectorAll("button").forEach(btn=>{
  btn.onclick=()=>{
   difficulty=btn.dataset.diff;localStorage.setItem("dh_difficulty",difficulty);
   diffModal.style.display="none";cb&&cb();
  };
 });
}
function getTimerSeconds(){
 if(difficulty==="easy")return 9999;
 if(difficulty==="hard")return 10;
 return 15;
}
function startCountdown(sec,onTick,onExpire){
 clearInterval(currentTimer);
 let t=sec;timerDisplay.textContent=t;
 currentTimer=setInterval(()=>{
  t--;timerDisplay.textContent=t;
  if(t<=0){clearInterval(currentTimer);onExpire&&onExpire();}
 },1000);
}
function stopTimers(){clearInterval(currentTimer);}

/* ---------- Shared Vars ---------- */
const homeEl=document.getElementById("home"),
gameArea=document.getElementById("gameArea"),
gamePanel=document.getElementById("gamePanel"),
contentArea=document.getElementById("contentArea"),
questionEl=document.getElementById("question"),
scoreDisplay=document.getElementById("scoreDisplay"),
timerDisplay=document.getElementById("timerDisplay"),
btnHome=document.getElementById("btnHome"),
backspaceBtn=document.getElementById("backspaceBtn");
let streak=0;

/* ---------- WORDSCAPE ---------- */
let wordList=window.dentalWords.map(w=>(typeof w==="string"?w:w.word).toUpperCase()),
currentWord="",sel=[],shuffled=[],wsScore=getHS(KEY_HS_WORD),
wordDone=loadJSON("dh_word_done")||{},powerUps=loadJSON("dh_power")||{reveal:0};
function startWordscape(){
 askDifficulty(()=>{openPanel();backspaceBtn.style.display="inline-block";
 wsScore=getHS(KEY_HS_WORD);scoreDisplay.textContent=wsScore;nextWord();});
}
function nextWord(){
 sel=[];stopTimers();
 const unsolved=wordList.filter(w=>!wordDone[w]);
 currentWord=unsolved[Math.floor(Math.random()*unsolved.length)]||wordList[Math.floor(Math.random()*wordList.length)];
 shuffled=shuffle(currentWord.split(""));renderWordscape();
}
function renderWordscape(){
 const solved=!!wordDone[currentWord];
 questionEl.textContent="Form the word";
 let level="Beginner";if(currentWord.length>5)level="Intermediate";if(currentWord.length>8)level="Advanced";
 const solvedCount=Object.keys(wordDone).length,percent=(solvedCount/wordList.length*100).toFixed(0);
 contentArea.innerHTML=`
 <div style='text-align:center;margin-bottom:4px;'>Level: ${level}</div>
 <div class="progress-bar"><div class="progress-fill" style="width:${percent}%"></div></div>
 <div class="word-row">${sel.map((c,i)=>`<div class='letter-chip' data-i='${i}'>${c}</div>`).join("")}</div>
 <div class="word-row">${shuffled.map((ch,i)=>`<button class='option-btn' data-i='${i}' ${ch===''?'disabled':''}>${ch}</button>`).join("")}</div>
 <div style='text-align:center;margin-top:12px;'>
  <button class='option-btn' id='hintBtn'>üí° Hint (-3)</button>
  <button class='option-btn' id='shuffleBtn'>üîÄ Shuffle</button>
  <button class='option-btn' id='skipBtn'>‚è≠ Next</button>
 </div>`;
 if(solved){
  questionEl.textContent=`‚úÖ ${currentWord}`;
  contentArea.querySelectorAll(".option-btn").forEach(b=>{b.classList.add("correct");b.disabled=true;});
  return;
 }
 contentArea.querySelectorAll(".option-btn[data-i]").forEach(btn=>{
  btn.onclick=()=>{
   if(btn.disabled)return;
   playSFX("click");sel.push(shuffled[btn.dataset.i]);shuffled[btn.dataset.i]="";renderWordscape();
   const chips=document.querySelectorAll(".letter-chip");if(chips.length)chips[chips.length-1].classList.add("pop");
   if(sel.join("")===currentWord){playSFX("correct");vibrate(60);showToast("‚úÖ Correct!");
     streak++;if(streak%3===0){wsScore+=5;showToast("+5 Streak Bonus!");}
     wsScore+=10;animateScore(scoreDisplay,parseInt(scoreDisplay.textContent),wsScore);
     setHS(KEY_HS_WORD,wsScore);wordDone[currentWord]=true;saveJSON("dh_word_done",wordDone);
     scoreDisplay.textContent=wsScore;setTimeout(nextWord,800);}
  };
 });
 document.getElementById("shuffleBtn").onclick=()=>{shuffled=shuffle(currentWord.split(""));renderWordscape();};
 document.getElementById("skipBtn").onclick=()=>{nextWord();};
 document.getElementById("hintBtn").onclick=()=>{
   if(wsScore<3){showToast("Not enough points!");return;}
   wsScore-=3;setHS(KEY_HS_WORD,wsScore);animateScore(scoreDisplay,parseInt(scoreDisplay.textContent),wsScore);
   const unrevealed=currentWord.split("").filter(ch=>!sel.includes(ch));
   if(unrevealed.length){sel.push(unrevealed[0]);renderWordscape();}
 };
 backspaceBtn.onclick=()=>{if(sel.length){const r=sel.pop();const e=shuffled.indexOf("");if(e!==-1)shuffled[e]=r;else shuffled.push(r);renderWordscape();}};
}

/* ---------- QUIZ & CASE ---------- */
let quizData=window.dentalQuiz||[],caseData=window.dentalCases||[],
quizIndex=0,caseIndex=0,quizScore=getHS(KEY_HS_QUIZ),caseScore=getHS(KEY_HS_CASE),
quizDone=loadJSON("dh_quiz_done")||{},caseDone=loadJSON("dh_case_done")||{},
quizMissed=loadJSON("dh_quiz_missed")||{},caseMissed=loadJSON("dh_case_missed")||{};
function startQuiz(retryMode=false){
 askDifficulty(()=>{openPanel();backspaceBtn.style.display="none";
 quizScore=getHS(KEY_HS_QUIZ);scoreDisplay.textContent=quizScore;
 if(retryMode){quizData=Object.values(quizMissed);}renderQuiz();});
}
function renderQuiz(){
 stopTimers();const q=quizData[quizIndex];
 if(!q){questionEl.textContent="No questions.";contentArea.innerHTML="";return;}
 questionEl.textContent=q.question;
 contentArea.innerHTML=`<div class='options'>
 ${q.options.map(o=>`<button class='option-btn'>${o}</button>`).join("")}</div>
 <div style='text-align:center;margin-top:10px;'>
  <button class='option-btn' id='hintBtn'>üí° Hint (-3)</button>
  <button class='option-btn' id='prevQ'>‚¨ÖÔ∏è</button>
  <button class='option-btn' id='nextQ'>‚û°Ô∏è</button>
 </div>`;
 const buttons=contentArea.querySelectorAll(".option-btn:not(#hintBtn):not(#prevQ):not(#nextQ)");
 if(quizDone[quizIndex])buttons.forEach(b=>{if(b.textContent.trim().toLowerCase()===q.answer.trim().toLowerCase())b.classList.add("correct");b.disabled=true;});
 buttons.forEach(b=>{
  b.onclick=()=>{
   if(quizDone[quizIndex])return;
   playSFX("click");stopTimers();
   const isCorrect=b.textContent.trim().toLowerCase()===q.answer.trim().toLowerCase();
   if(isCorrect){b.classList.add("correct");showToast("‚úÖ Correct!");playSFX("correct");vibrate(60);
     streak++;if(streak%3===0){quizScore+=5;showToast("+5 Streak Bonus!");}
     quizScore+=10;animateScore(scoreDisplay,parseInt(scoreDisplay.textContent),quizScore);
     setHS(KEY_HS_QUIZ,quizScore);quizDone[quizIndex]=true;saveJSON("dh_quiz_done",quizDone);
     delete quizMissed[quizIndex];saveJSON("dh_quiz_missed",quizMissed);
     buttons.forEach(btn=>btn.disabled=true);
   }else{
     b.classList.add("wrong");showToast("‚ùå Incorrect!");playSFX("wrong");vibrate(60);
     quizMissed[quizIndex]=q;saveJSON("dh_quiz_missed",quizMissed);
     streak=0;setTimeout(()=>{quizIndex=(quizIndex+1)%quizData.length;renderQuiz();},1300);
   }
  };
 });
 document.getElementById("hintBtn").onclick=()=>{
   if(quizScore<3){showToast("Not enough points!");return;}
   quizScore-=3;setHS(KEY_HS_QUIZ,quizScore);animateScore(scoreDisplay,parseInt(scoreDisplay.textContent),quizScore);
   const wrongs=[...buttons].filter(b=>b.textContent.trim().toLowerCase()!==q.answer.trim().toLowerCase());
   if(wrongs.length){wrongs[Math.floor(Math.random()*wrongs.length)].disabled=true;}
 };
 document.getElementById("prevQ").onclick=()=>{quizIndex=(quizIndex-1+quizData.length)%quizData.length;renderQuiz();};
 document.getElementById("nextQ").onclick=()=>{quizIndex=(quizIndex+1)%quizData.length;renderQuiz();};
 startCountdown(getTimerSeconds(),null,()=>{quizIndex=(quizIndex+1)%quizData.length;renderQuiz();});
}
function startCase(retryMode=false){
 askDifficulty(()=>{openPanel();backspaceBtn.style.display="none";
 caseScore=getHS(KEY_HS_CASE);scoreDisplay.textContent=caseScore;
 if(retryMode){caseData=Object.values(caseMissed);}renderCase();});
}
function renderCase(){
 stopTimers();const c=caseData[caseIndex];
 if(!c){questionEl.textContent="No cases.";contentArea.innerHTML="";return;}
 questionEl.textContent=c.case;
 contentArea.innerHTML=`<div class='options'>
 ${c.options.map(o=>`<button class='option-btn'>${o}</button>`).join("")}</div>
 <div style='text-align:center;margin-top:10px;'>
  <button class='option-btn' id='hintBtn'>üí° Hint (-3)</button>
  <button class='option-btn' id='prevC'>‚¨ÖÔ∏è</button>
  <button class='option-btn' id='nextC'>‚û°Ô∏è</button>
 </div>`;
 const buttons=contentArea.querySelectorAll(".option-btn:not(#hintBtn):not(#prevC):not(#nextC)");
 if(caseDone[caseIndex])buttons.forEach(b=>{if(b.textContent.trim().toLowerCase()===c.answer.trim().toLowerCase())b.classList.add("correct");b.disabled=true;});
 buttons.forEach(b=>{
  b.onclick=()=>{
   if(caseDone[caseIndex])return;
   playSFX("click");stopTimers();
   const isCorrect=b.textContent.trim().toLowerCase()===c.answer.trim().toLowerCase();
   if(isCorrect){b.classList.add("correct");showToast("‚úÖ Correct!");playSFX("correct");vibrate(60);
     streak++;if(streak%3===0){caseScore+=5;showToast("+5 Streak Bonus!");}
     caseScore+=10;animateScore(scoreDisplay,parseInt(scoreDisplay.textContent),caseScore);
     setHS(KEY_HS_CASE,caseScore);caseDone[caseIndex]=true;saveJSON("dh_case_done",caseDone);
     delete caseMissed[caseIndex];saveJSON("dh_case_missed",caseMissed);
     buttons.forEach(btn=>btn.disabled=true);
   }else{
     b.classList.add("wrong");showToast("‚ùå Incorrect!");playSFX("wrong");vibrate(60);
     caseMissed[caseIndex]=c;saveJSON("dh_case_missed",caseMissed);
     streak=0;setTimeout(()=>{caseIndex=(caseIndex+1)%caseData.length;renderCase();},1300);
   }
  };
 });
 document.getElementById("hintBtn").onclick=()=>{
   if(caseScore<3){showToast("Not enough points!");return;}
   caseScore-=3;setHS(KEY_HS_CASE,caseScore);animateScore(scoreDisplay,parseInt(scoreDisplay.textContent),caseScore);
   const wrongs=[...buttons].filter(b=>b.textContent.trim().toLowerCase()!==c.answer.trim().toLowerCase());
   if(wrongs.length){wrongs[Math.floor(Math.random()*wrongs.length)].disabled=true;}
 };
 document.getElementById("prevC").onclick=()=>{caseIndex=(caseIndex-1+caseData.length)%caseData.length;renderCase();};
 document.getElementById("nextC").onclick=()=>{caseIndex=(caseIndex+1)%caseData.length;renderCase();};
 startCountdown(getTimerSeconds(),null,()=>{caseIndex=(caseIndex+1)%caseData.length;renderCase();});
}

/* ---------- Navigation ---------- */
function openPanel(){homeEl.style.display="none";gameArea.style.display="flex";
 setTimeout(()=>gamePanel.classList.add("show"),20);}
function closePanel(){
 gamePanel.classList.remove("show");
 setTimeout(()=>{gameArea.style.display="none";homeEl.style.display="";
 contentArea.innerHTML="";questionEl.textContent="Loading...";
 stopTimers();refreshHS();},300);
}
document.getElementById("openWordscape").onclick=()=>startWordscape();
document.getElementById("openQuiz").onclick=()=>startQuiz();
document.getElementById("openCase").onclick=()=>startCase();
document.getElementById("openRetry").onclick=()=>{
 let mode=prompt("Retry Quiz or Case? (type quiz/case)");
 if(mode&&mode.toLowerCase()==="quiz")startQuiz(true);
 else if(mode&&mode.toLowerCase()==="case")startCase(true);
 else showToast("Cancelled");
};
btnHome.onclick=()=>closePanel();

/* ---------- Theme Toggle ---------- */
const themeBtn=document.getElementById("themeBtn");
let darkMode=localStorage.getItem("darkMode")!=="false";
function applyTheme(){
 document.body.style.background=darkMode?
 "radial-gradient(circle at top left,#001427 0%,#00111f 35%,#000814 100%)":
 "linear-gradient(180deg,#e9faff,#b8f5ff)";
 document.body.style.color=darkMode?"#fff":"#003";
}
applyTheme();
themeBtn.onclick=()=>{darkMode=!darkMode;localStorage.setItem("darkMode",darkMode);applyTheme();};

/* ---------- Reset Progress ---------- */
document.getElementById("resetBtn").onclick=()=>{
 const opt=prompt("Reset (word/quiz/case/all)?");
 if(!opt)return;
 const keys={
  word:["dh_word_done",KEY_HS_WORD],
  quiz:["dh_quiz_done","dh_quiz_missed",KEY_HS_QUIZ],
  case:["dh_case_done","dh_case_missed",KEY_HS_CASE]
 };
 if(opt==="all"){Object.values(keys).flat().forEach(k=>localStorage.removeItem(k));}
 else if(keys[opt]){keys[opt].forEach(k=>localStorage.removeItem(k));}
 refreshHS();showToast("Progress reset!");
};

/* ---------- Background Bubbles ---------- */
(function makeBubbles(c=20){
 const b=document.getElementById("bubbles");
 for(let i=0;i<c;i++){
   const d=document.createElement("div");
   d.className="bubble";
   const s=12+Math.random()*42;
   d.style.width=d.style.height=s+"px";
   d.style.left=Math.random()*100+"vw";
   d.style.animationDuration=8+Math.random()*9+"s";
   d.style.opacity=0.4+Math.random()*0.6;
   b.appendChild(d);
 }
})();
</script>
</body>
</html>
